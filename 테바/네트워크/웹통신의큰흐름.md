# 웹 통신의 큰 흐름: https://www.google.com/ 을 접속할 때 일어나는 일

웹 통신의 전체적인 흐름을 이해하려면, 클라이언트(브라우저)에서 특정 웹사이트를 요청했을 때부터 그 응답이 도착하고 브라우저에 렌더링되는 과정을 순서대로 설명해야 함. 예시로 **https://www.google.com/** 을 접속할 때 일어나는 주요 단계를 설명한다. 

### 1. **URL 입력 및 DNS 조회**
   - 사용자가 브라우저에 **https://www.google.com/** 을 입력하면, 먼저 브라우저는 이 URL에 해당하는 **IP 주소**를 알아내야 합니다.
   - 이를 위해 **DNS(Domain Name System)** 서버에 질의하여, **google.com** 도메인에 연결된 IP 주소(예: 142.250.190.78)를 반환받습니다.
     - 캐싱: 브라우저 또는 운영체제는 최근에 사용된 DNS 결과를 캐시에 저장하여, 같은 요청이 반복되면 DNS 서버에 요청하지 않고 캐시에서 바로 IP 주소를 가져옵니다.

### 2. **TCP 연결 설정**
   - IP 주소가 확인되면, 브라우저는 **TCP(Transmission Control Protocol)** 연결을 시작합니다.
   - 이때 클라이언트와 서버 간의 **3-way handshake** 과정이 진행됩니다:
     1. 클라이언트는 서버에 **SYN** 패킷을 보내 연결 요청을 합니다.
     2. 서버는 이를 받아 **SYN-ACK** 패킷을 응답으로 보냅니다.
     3. 클라이언트는 다시 **ACK** 패킷을 보내며 연결이 성립됩니다.

### 3. **TLS 핸드셰이크 (HTTPS)**
   - **https://** 로 시작하는 URL을 요청했으므로, 안전한 통신을 위해 **TLS(Transport Layer Security)** 핸드셰이크가 진행됩니다.
     - 클라이언트와 서버는 암호화에 사용할 **대칭키**를 교환하고, 이를 통해 통신이 암호화됩니다.
     - 또한 서버는 **SSL 인증서**를 클라이언트에 제공하여, 신뢰할 수 있는 서버임을 증명합니다.
   
### 4. **HTTP 요청 전송**
   - TLS 핸드셰이크가 완료되면, 클라이언트는 **HTTP 요청**을 보냅니다.
     - 이 요청은 **GET** 메서드를 사용하며, `https://www.google.com/`이라는 URL의 리소스를 요청하게 됩니다.
     - 요청 헤더에는 사용자 에이전트, 쿠키, 인코딩 방식 등 브라우저의 정보가 포함됩니다.

### 5. **서버 측 처리**
   - 구글의 서버는 클라이언트로부터 요청을 받으면 해당 요청을 분석하고 처리합니다.
     - 서버는 URL에 매핑된 리소스(구글 홈페이지)를 가져오기 위한 **비즈니스 로직**과 **데이터베이스 조회** 등의 작업을 처리합니다.
     - 예를 들어, 서버는 구글 메인 페이지를 구성하는 HTML, CSS, JavaScript, 이미지 등을 준비합니다.

### 6. **HTTP 응답 전송**
   - 서버는 준비된 데이터를 **HTTP 응답**으로 클라이언트에 보냅니다.
     - 응답은 **상태 코드**(예: 200 OK)와 함께 HTML 콘텐츠를 포함합니다.
     - 응답 헤더에는 콘텐츠 타입(예: `text/html`), 콘텐츠 길이, 캐시 관련 정보 등이 포함됩니다.

### 7. **브라우저 렌더링**
   - 클라이언트(브라우저)는 서버로부터 받은 HTML 문서를 분석하고, 이를 기반으로 렌더링을 시작합니다.
     1. HTML 문서를 **파싱**하면서 필요한 추가 리소스(CSS 파일, JS 파일, 이미지 파일 등)를 식별합니다.
     2. 추가 리소스가 있으면 그에 대한 **병렬 요청**을 보내고, 각 리소스가 도착할 때마다 해당 내용을 반영합니다.
     3. **DOM(Document Object Model)** 트리를 구축하고, CSSOM(CSS Object Model)과 함께 **렌더 트리**를 구성합니다.
     4. 최종적으로 브라우저가 **구글 메인 페이지**를 화면에 렌더링합니다.

### 8. **JavaScript 실행**
   - 렌더링 중에 포함된 **JavaScript** 파일들이 로드되면, 브라우저는 이를 **자바스크립트 엔진**을 통해 실행합니다.
     - 구글 메인 페이지의 인터랙티브한 부분들(검색 상자 자동 완성 등)이 동작하게 됩니다.

### 9. **추가 리소스 요청**
   - 브라우저가 처음 로딩한 HTML 외에도, 필요에 따라 사용자가 구글 검색 등을 시도하면 추가적인 **AJAX 요청**이 발생하며, 검색 결과 데이터를 가져오고 동적으로 페이지에 반영합니다.

### 10. **종료 및 캐싱**
   - 페이지를 성공적으로 로딩하고 나면, 브라우저는 일부 리소스(예: 이미지, CSS 파일)를 **캐시**에 저장해 이후에 동일한 페이지 요청 시 더 빠르게 로딩할 수 있도록 준비합니다.
   - TCP 연결은 일정 시간 동안 유지되며, 이후 **4-way handshake**를 통해 연결이 종료될 수 있습니다.

# 모우다의 아키텍쳐
![](../image/인프라%20구조.png)

## TCP 연결은 위 구조 중 누구와 맺게 되는가? 
맨 먼저 웹서버인 nginx 가 요청을 받습니다. 이때 클라이언트와 nginx와의 tcp 연결이 발생합니다. 

만약 클라이언트의 요청이 동적 데이터일 경우 nginx 는 was 인 스프링 내장 톰캣과 tcp 연결을 맺어 요청을 전달하고 가공된 데이터를 전달받아 클라이언트에게 보냅니다. 

